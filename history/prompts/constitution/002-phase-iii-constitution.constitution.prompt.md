---
id: 002
title: Phase III AI-Powered Todo Chatbot Constitution
stage: constitution
date: 2025-01-25
surface: agent
model: claude-sonnet-4-5
feature: none
branch: phase-2
user: User
command: /sp.constitution
labels: ["constitution","phase-iii","ai-chatbot","mcp","qwen","multi-language"]
links:
  spec: null
  ticket: null
  adr: null
  pr: null
files:
  - .specify/memory/constitution.md
  - history/prompts/constitution/002-phase-iii-constitution.constitution.prompt.md
tests:
  - Constitution template validation
  - Placeholder resolution verification
  - Version increment validation
  - Governance section completeness check
---

## Prompt

To start Phase III (AI-Powered Todo Chatbot) professionally, you need to establish the **`speckit.constitution`**. According to the sources, the Constitution defines the "Why"â€”the non-negotiable principles, architecture values, and tech stack constraints that govern the AI agents [1, 2].

Since you are using **Qwen (via Hugging Face SDK)** and the **Official MCP SDK**, here is the comprehensive Constitution for your project. You should save this in your `specs/` or root directory as defined by your Spec-Kit structure [3, 4].

---

# **Phase III Constitution: AI-Powered Todo Chatbot**

## **1. Core Objective**
The system must evolve from a standard web application into a **conversational AI-native system** where users manage tasks through natural language [5-7].

## **2. Technical Stack Constraints**
*   **AI Engine:** Use **Qwen** (via Hugging Face SDK) for all natural language processing and reasoning [Source: User Query].
*   **Agent Architecture:** Use the **Official MCP SDK** to build a Model Context Protocol server that exposes task operations as tools [8-10].
*   **Database:** Utilize **Neon Serverless PostgreSQL** for persistent storage of tasks, conversations, and messages [9, 11, 12].
*   **Backend:** Maintain the **FastAPI** and **SQLModel** stack established in Phase II [9, 11].

## **3. Architectural Principles**
*   **Stateless Server:** The backend must hold **no session state**. Every request must be independent, fetching conversation history from the database to build the message array for the agent [13, 14].
*   **Persistence of Intelligence:** All chat sessions must be stored in `Conversation` and `Message` tables to ensure context is maintained across server restarts [12, 15].
*   **Reusable Intelligence:** Implementation must favor **Agent Skills and Subagents** to ensure logic is modular and reusable [8, 16, 17].

## **4. Security & User Isolation**
*   **JWT Enforcement:** Every chat request must verify the **Better Auth JWT token** from Phase II [18, 19].
*   **Strict Isolation:** The AI agent is strictly prohibited from accessing or modifying any task that does not belong to the authenticated `user_id` [10, 19, 20].

## **5. Language & Interaction**
*   **Multi-language Support:** The chatbot must support **Urdu and English** for both input commands and assistant responses [16].
*   **Action Confirmation:** The AI must always provide a friendly confirmation in the user's language after executing a tool call (e.g., adding or deleting a task) [15, 21].

## **6. Development Workflow (SDD)**
*   **No Task = No Code:** No agent is allowed to generate code without a referenced Task ID from `speckit.tasks` [22, 23].
*   **Hierarchy of Truth:** In case of conflict, the hierarchy is: **Constitution > Specify > Plan > Tasks** [24].
*   **Manual Coding Ban:** All implementation must be generated by **Claude Code** after refining the specification [25-27].

---

### **How to use this with Claude Code:**
1.  **Paste this into your `speckit.constitution` file.**
2.  **In Claude CLI, run:**
    > `"Read @speckit.constitution. This is the foundation for Phase III. Now, use /sp specify (or create @speckit.specify) to define the natural language user journeys for adding and deleting tasks in both Urdu and English."` [28, 29].

By setting these rules now, you ensure that **Phase II's authentication and logic remain error-free** while building a modern, production-ready chatbot [19, 30].

## Response snapshot

Established comprehensive Phase III constitution at `.specify/memory/constitution.md` with the following structure:

**Version**: 3.0.0 (MAJOR bump from 1.0.0)
**Ratification**: 2025-01-25

**Core Principles Defined** (6 non-negotiable principles):
1. **AI-Native Interaction** - Chatbot as primary interface, not add-on
2. **Stateless Server Architecture** - No session state, all state persisted
3. **Persistence of Intelligence** - Conversation/Message tables for context
4. **Strict Security & User Isolation** - JWT enforcement, user_id filtering
5. **Multi-Language Support** - English and Urdu with auto-detection
6. **MCP-First Tool Design** - All operations via Official MCP SDK

**Technical Stack Constraints**:
- AI: Qwen via Hugging Face SDK
- Architecture: Official MCP SDK
- Database: Neon PostgreSQL with Conversation/Message tables
- Backend: FastAPI + SQLModel (Phase II stack maintained)
- Frontend: Next.js with streaming support

**Key Requirements**:
- Stateless server with database-retrieved conversation history
- Bilingual confirmations (English/Urdu) after every tool call
- Absolute user isolation - no cross-user data access
- MCP tools as exclusive AI interface (no direct DB access)
- Performance: <10s p95 latency for chat
- No code without Task ID reference (SDD enforcement)

**Data Model**:
- Conversation table (id, user_id, title, language, timestamps)
- Message table (id, conversation_id, role, content, tool_calls)
- Preserves Phase II Todo and User tables

**Definition of Done** includes 12 validation checkpoints covering principles, implementation, security, performance, and Phase II regression prevention.

Constitution serves as the foundation for `/sp.specify` to define NLP user journeys for task management in both languages.

## Outcome

- âœ… Impact: Foundation established for Phase III AI-powered chatbot with clear governance principles
- ðŸ§ª Tests: Template validation passed, all placeholders resolved, version increment validated
- ðŸ“ Files: `.specify/memory/constitution.md` created with comprehensive Phase III governance
- ðŸ” Next prompts: Run `/sp.specify` to define natural language user journeys for task CRUD operations in English and Urdu
- ðŸ§  Reflection: Constitution balances innovation (AI-native) with preservation (Phase II stability), enforces security through user isolation, and enables bilingual accessibility

## Evaluation notes (flywheel)

- Failure modes observed: None - template successfully populated with all required sections
- Graders run and results (PASS/FAIL):
  - Placeholder resolution: PASS (all [TOKENS] replaced)
  - Version semantic correctness: PASS (3.0.0 MAJOR for new phase)
  - Governance completeness: PASS (amendment procedure, compliance, version policy defined)
  - Principle testability: PASS (all 6 principles declarative and enforceable)
- Prompt variant (if applicable): N/A
- Next experiment (smallest change to try): Proceed to `/sp.specify` to define NLP user journeys (add/delete tasks in English/Urdu)
