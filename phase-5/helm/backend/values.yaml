# Default values for backend Helm chart
# This is a YAML-formatted file.

replicaCount: 1

image:
  repository: todo-backend
  pullPolicy: IfNotPresent
  tag: "latest"

# Override with image.tag for specific version
# tag: "sha-xyz123"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false

service:
  type: ClusterIP
  port: 8000

ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: backend.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: backend-tls

resources:
  limits:
    memory: "512Mi"
    cpu: "500m"
  requests:
    memory: "256Mi"
    cpu: "250m"

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# Dapr sidecar configuration
dapr:
  enabled: true
  appId: "backend-service"
  appPort: 8000
  config: "app-config"
  components:
    - name: pubsub
      type: pubsub.kafka
      version: v1
      metadata:
        - name: brokers
          value: "kafka.kafka.svc.cluster.local:9092"
        - name: consumerGroup
          value: "todo-service"
        - name: authRequired
          value: "false"
    - name: statestore
      type: state.postgresql
      version: v1
      metadata:
        - name: connectionString
          secretKeyRef:
            name: db-credentials
            key: connectionstring
    - name: kubernetes-secrets
      type: secretstores.kubernetes
      version: v1

# Environment variables
env:
  - name: LOG_LEVEL
    value: "INFO"
  - name: DAPR_HTTP_PORT
    value: "3500"

# Environment variables from secrets
envFromSecret:
  - name: DATABASE_URL
    secretName: db-credentials
    secretKey: connectionstring
  - name: OLLAMA_URL
    secretName: ollama-config
    secretKey: url

# Health probes
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /ready
    port: http
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 3

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Database configuration
database:
  host: "neon.db"
  port: 5432
  name: "todo"
  user: "postgres"
  # Password should be in secret
